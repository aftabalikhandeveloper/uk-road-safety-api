services:
  # FastAPI Backend - connects to your local PostgreSQL
  api:
    build:
      context: .
      dockerfile: Dockerfile.api
    container_name: road_safety_api
    environment:
      DATABASE_URL: postgresql://postgres:pass@host.docker.internal:5432/roadsafety
      API_SECRET_KEY: ${API_SECRET_KEY:-change-this-in-production}
    ports:
      - "8000:8000"
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - road_safety_network

  # React Frontend (nginx)
  frontend:
    build:
      context: ./dashboard
      dockerfile: Dockerfile
    container_name: road_safety_frontend
    ports:
      - "${PORT:-80}:80"
    depends_on:
      - api
    restart: unless-stopped
    networks:
      - road_safety_network

networks:
  road_safety_network:
    driver: bridge
